tribe.events=tribe.events||{},tribe.events.virtualAdmin=tribe.events.virtualAdmin||{},function(e,t,o){var r=e(document);t.selectors={autoDetectButton:".tribe-events-virtual-video-source-autodetect__button",autoDetectFields:".tribe-events-virtual-video-source-autodetect__fields",autoDetectSource:"#tribe-events-virtual-autodetect-source",autoDetectMessagesWrap:".tribe-events-virtual-video-source-autodetect__messages-wrap",autoDetectMessage:".tribe-events-virtual-settings-message__wrap",autoDetectloader:".tribe-common-c-loader",autoDetectPreviewWrap:".tec-autodetect-video-preview__container",autoDetectPreview:".tec-autodetect-video-preview__inner",autoDetecthiddenElement:".tribe-common-a11y-hidden",configure:".tribe-configure-virtual-button",displayOption:".tribe-events-virtual-display",displayOptionCheckbox:'.tribe-events-virtual-display input[type="checkbox"]',embedCheckbox:"#tribe-events-virtual-embed-video",remove:".tribe-remove-virtual-event",setupCheckbox:"#tribe-events-virtual-setup",showOptions:".tribe-events-virtual-show input",showAll:"#tribe-events-virtual-show-to-all",videoSource:"#tribe-events-virtual-video-source",videoSourcesWrap:".tribe-events-virtual-video-sources-wrap",videoSourceDetails:".tribe-events-virtual-video-sources",videoSourcesFloat:".tribe-events-virtual-video-sources--float",virtualContainer:"#tribe-virtual-events",virtualUrl:".tribe-events-virtual-video-source__virtual-url-input",embedNotice:".tribe-events-virtual-video-source__not-embeddable-notice",embedNoticeShow:".tribe-events-virtual-video-source__not-embeddable-notice--show",embedNoticeText:".tribe-events-virtual-video-source__not-embeddable-text"},t.setCheckboxCheckedAttr=function(o){return t.isGutenbergActive()?function(){const i=wp.data.select("core/block-editor").getBlocks(),c=i.find(e=>"tribe/event-price"===e.name);if(o){if(i.filter(e=>"tribe/virtual-event"===e.name).length)return void e(t.selectors.setupCheckbox).prop("checked",o).trigger("verify.dependency");if(c){const e=wp.data.select("core/block-editor").getBlockIndex(c.clientId),t=wp.blocks.createBlock("tribe/virtual-event");wp.data.dispatch("core/block-editor").insertBlock(t,e+1,"",!1)}else{const e=wp.blocks.createBlock("tribe/virtual-event");wp.data.dispatch("core/block-editor").insertBlock(e)}r.trigger("virtual.add"),document.getElementById("tribe-virtual-events").scrollIntoView()}else{if(!confirm(tribe_events_virtual_strings.deleteConfirm))return;tribe.events.metaboxDelete=!0,i.forEach(e=>{"tribe/virtual-event"===e.name&&wp.data.dispatch("core/block-editor").removeBlock(e.clientId)}),r.trigger("virtual.delete"),tribe.events.metaboxDelete=!1}e(t.selectors.setupCheckbox).prop("checked",o).trigger("verify.dependency")}:function(){if(o)r.trigger("virtual.add");else{if(!confirm(tribe_events_virtual_strings.deleteConfirm))return;r.trigger("virtual.delete")}e(t.selectors.setupCheckbox).prop("checked",o).trigger("verify.dependency")}},t.show=function(e){const o=e.find(t.selectors.autoDetectloader);o.length&&o.removeClass(t.selectors.autoDetecthiddenElement.className())},t.hide=function(e){const o=e.find(t.selectors.autoDetectloader);o.length&&o.addClass(t.selectors.autoDetecthiddenElement.className())},t.handleVideoPreviewOnLoad=function(){const o=e(t.selectors.autoDetectPreview);0!==e.trim(o.html()).length&&e(t.selectors.autoDetectPreviewWrap).removeClass("hide-preview")},t.handleAutoDetectVideoPreview=function(o,i){if(!i.html)return;const c=e(i.html).filter(t.selectors.autoDetectPreview);0!==c.length&&(e(t.selectors.autoDetectPreviewWrap).removeClass("hide-preview"),e(t.selectors.autoDetectPreview).replaceWith(c),r.trigger("autodetect.videoPreview",{html:i.html}))},t.onAutoDetectSuccess=function(i){t.hide(e(".tribe-events-virtual-video-source-autodetect__inner-controls")),r.trigger("autodetect.complete",{html:i});const c=e(i).filter(t.selectors.autoDetectMessage),s=e(i).filter(t.selectors.autoDetectFields);e(t.selectors.autoDetectMessagesWrap).html(c),0!==s.length&&(e(t.selectors.autoDetectFields).replaceWith(s),e(t.selectors.autoDetectFields).find(o.selector.dropdown).not(o.selector.created).tribe_dropdowns(),e(t.selectors.autoDetectSource).trigger("setup.dependency").trigger("verify.dependency"))},t.detectSource=function(){if("video"!==e(t.selectors.videoSource).val())return;const o=e(t.selectors.virtualUrl),r=o.val(),i=o.data("autodetectAjaxUrl"),c=e("[name^='tribe-events-virtual-autodetect']"),s={};c.map(function(){let t=e(this).prop("name").match(/\[(.*?)\]/)[1];s[t]=this.value}).get(),t.show(e(".tribe-events-virtual-video-source-autodetect__inner-controls")),e(t.selectors.autoDetectPreviewWrap).addClass("hide-preview"),e.ajax(i,{contentType:"application/json",context:e(t.selectors.videoSourceDetails),data:{video_url:r,ajax_data:s},success:t.onAutoDetectSuccess})},t.handleShowOptionEnablement=function(){var o=e(t.selectors.displayOption).find(":checked:visible").length,r=e(t.selectors.showOptions);o>0?r.prop({disabled:!1}):r.prop({disabled:!0})},t.handleShowOptionInteractivity=function(o){if(o&&Object.prototype.hasOwnProperty.call(o,"target")){var r=e(o.target);r.prop("checked")&&"all"!==r.val()&&e(t.selectors.showAll).prop("checked",!1)}},t.bindEvents=function(){e(t.selectors.virtualContainer).on("click",t.selectors.configure,t.setCheckboxCheckedAttr(!0)).on("click",t.selectors.remove,t.setCheckboxCheckedAttr(!1)).on("click",t.selectors.autoDetectButton,t.detectSource).on("click",t.selectors.displayOptionCheckbox,t.handleShowOptionEnablement).on("change",t.selectors.showOptions,t.handleShowOptionInteractivity),r.on("autodetect.complete",t.handleAutoDetectVideoPreview)},t.isGutenbergActive=function(){return"undefined"!=typeof wp&&void 0!==wp.blocks&&void 0!==wp.data&&!!wp.data.select("core/blocks").getBlockType("tribe/virtual-event")},t.ready=function(){t.bindEvents(),setTimeout(function(){e(t.selectors.videoSource).trigger("verify.dependency")},0),t.handleVideoPreviewOnLoad()},t.testEmbed=function(){if(console.info("Method deprecated and replaced with Autodetect feature."),"video"!==e(t.selectors.videoSource).val())return;const o=e(t.selectors.virtualUrl),r=o.val(),i=o.attr("data-nonce");o.attr("data-oembed-test")&&r&&i?e.ajax({type:"post",dataType:"json",url:ajaxurl,data:{action:"tribe_events_virtual_check_oembed",url:r,nonce:i}}).done(function(){t.hideOembedNotice()}).fail(function(e){t.showOembedNotice(e)}):t.hideOembedNotice()},t.hideOembedNotice=function(){console.info("Method deprecated and replaced with Autodetect feature."),e(t.selectors.embedNotice).removeClass(t.selectors.embedNoticeShow.className()),e(t.selectors.embedCheckbox).prop({disabled:!1})},t.showOembedNotice=function(o){console.info("Method deprecated and replaced with Autodetect feature."),e(t.selectors.embedNoticeText).html(o.responseJSON.data),e(t.selectors.embedNotice).addClass(t.selectors.embedNoticeShow.className()),e(t.selectors.embedCheckbox).prop({disabled:!0,checked:!1})},t.handleVideoSourceClasses=function(){console.info("Method deprecated with no replacement.");var o=e(t.selectors.videoSourceDetails);if(o.length){var r=e(t.selectors.videoSourcesWrap);r.parent().width()>=o.outerWidth(!0)+r.outerWidth(!0)?o.addClass(t.selectors.videoSourcesFloat.className()):o.removeClass(t.selectors.videoSourcesFloat.className())}},e(t.ready)}(jQuery,tribe.events.virtualAdmin,tribe_dropdowns);